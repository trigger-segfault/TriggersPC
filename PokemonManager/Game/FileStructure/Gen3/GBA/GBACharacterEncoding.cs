using PokemonManager.Util;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace PokemonManager.Game.FileStructure.Gen3.GBA {
	public static class GBACharacterEncoding {

		//http://bulbapedia.bulbagarden.net/wiki/Character_encoding_in_Generation_III

		#region English Table

		private static Dictionary<byte, string> romTable = new Dictionary<byte, string>() {
			{0, " "},
			{1, "À"},
			{2, "Á"},
			{3, "Â"},
			{4, "Ç"},
			{5, "È"},
			{6, "É"},
			{7, "Ê"},
			{8, "Ë"},
			{9, "Ì"},
			{11, "Î"},
			{12, "Ï"},
			{13, "Ò"},
			{14, "Ó"},
			{15, "Ô"},
			{16, "Œ"},
			{17, "Ù"},
			{18, "Ú"},
			{19, "Û"},
			{20, "Ñ"},
			{21, "ß"},
			{22, "à"},
			{23, "á"},
			{25, "ç"},
			{26, "è"},
			{27, "é"},
			{28, "ê"},
			{29, "ë"},
			{30, "ì"},
			{32, "î"},
			{33, "ï"},
			{34, "ò"},
			{35, "ó"},
			{36, "ô"},
			{37, "œ"},
			{38, "ù"},
			{39, "ú"},
			{40, "û"},
			{41, "ñ"},
			{42, "º"},
			{43, "ª"},
			{45, "&"},
			{46, "+"},
			{53, "="},
			{81, "¿"},
			{82, "¡"},
			{90, "Í"},
			{91, "%"},
			{92, "("},
			{93, ")"},
			{104, "â"},
			{111, "í"},
			{161, "0"},
			{162, "1"},
			{163, "2"},
			{164, "3"},
			{165, "4"},
			{166, "5"},
			{167, "6"},
			{168, "7"},
			{169, "8"},
			{170, "9"},
			{171, "!"},
			{172, "?"},
			{173, "."},
			{174, "-"},
			{175, "・"},
			{176, "…"},
			{177, "“"},
			{178, "”"},
			{179, "‘"},
			{180, "’"},
			{181, "♂"},
			{182, "♀"},
			{184, ","},
			{185, "×"},
			{186, "/"},
			{187, "A"},
			{188, "B"},
			{189, "C"},
			{190, "D"},
			{191, "E"},
			{192, "F"},
			{193, "G"},
			{194, "H"},
			{195, "I"},
			{196, "J"},
			{197, "K"},
			{198, "L"},
			{199, "M"},
			{200, "N"},
			{201, "O"},
			{202, "P"},
			{203, "Q"},
			{204, "R"},
			{205, "S"},
			{206, "T"},
			{207, "U"},
			{208, "V"},
			{209, "W"},
			{210, "X"},
			{211, "Y"},
			{212, "Z"},
			{213, "a"},
			{214, "b"},
			{215, "c"},
			{216, "d"},
			{217, "e"},
			{218, "f"},
			{219, "g"},
			{220, "h"},
			{221, "i"},
			{222, "j"},
			{223, "k"},
			{224, "l"},
			{225, "m"},
			{226, "n"},
			{227, "o"},
			{228, "p"},
			{229, "q"},
			{230, "r"},
			{231, "s"},
			{232, "t"},
			{233, "u"},
			{234, "v"},
			{235, "w"},
			{236, "x"},
			{237, "y"},
			{238, "z"},
			{240, ":"},
			{241, "Ä"},
			{242, "Ö"},
			{243, "Ü"},
			{244, "ä"},
			{245, "ö"},
			{246, "ü"},
			{255, "█"}
		};

		private static Dictionary<byte, string> englishTable = new Dictionary<byte, string>() {
			{0, " "},
			{1, "À"},
			{2, "Á"},
			{3, "Â"},
			{4, "Ç"},
			{5, "È"},
			{6, "É"},
			{7, "Ê"},
			{8, "Ë"},
			{9, "Ì"},
			{11, "Î"},
			{12, "Ï"},
			{13, "Ò"},
			{14, "Ó"},
			{15, "Ô"},
			{16, "Œ"},
			{17, "Ù"},
			{18, "Ú"},
			{19, "Û"},
			{20, "Ñ"},
			{21, "ß"},
			{22, "à"},
			{23, "á"},
			{25, "ç"},
			{26, "è"},
			{27, "é"},
			{28, "ê"},
			{29, "ë"},
			{30, "ì"},
			{32, "î"},
			{33, "ï"},
			{34, "ò"},
			{35, "ó"},
			{36, "ô"},
			{37, "œ"},
			{38, "ù"},
			{39, "ú"},
			{40, "û"},
			{41, "ñ"},
			{42, "º"},
			{43, "ª"},
			{44, "█"}, //Superscript "er"
			{45, "&"},
			{46, "+"},
			{52, "Lv"},
			{53, "="},
			{81, "¿"},
			{82, "¡"},
			{83, "█"}, // PK from PKMN
			{84, "█"}, // MN from PKMN
			{85, "█"}, // PO from POKé
			{86, "█"}, // Ké from POKé
			{87, "█"}, // First character of Block in Pokeblock (BL)
			{88, "█"}, // Second character of Block in Pokeblock (OC)
			{89, "█"}, // Third character of Block in Pokeblock (K)
			{90, "Í"},
			{91, "%"},
			{92, "("},
			{93, ")"},
			{104, "â"},
			{111, "í"},
			{121, "⬆"},
			{122, "⬇"},
			{123, "⬅"},
			{124, "➡"},
			{161, "0"},
			{162, "1"},
			{163, "2"},
			{164, "3"},
			{165, "4"},
			{166, "5"},
			{167, "6"},
			{168, "7"},
			{169, "8"},
			{170, "9"},
			{171, "!"},
			{172, "?"},
			{173, "."},
			{174, "-"},
			{175, "・"},
			{176, "…"},
			{177, "“"},
			{178, "”"},
			{179, "‘"},
			{180, "’"},
			{181, "♂"},
			{182, "♀"},
			{183, "█"}, // The pokedollars sign
			{184, ","},
			{185, "×"},
			{186, "/"},
			{187, "A"},
			{188, "B"},
			{189, "C"},
			{190, "D"},
			{191, "E"},
			{192, "F"},
			{193, "G"},
			{194, "H"},
			{195, "I"},
			{196, "J"},
			{197, "K"},
			{198, "L"},
			{199, "M"},
			{200, "N"},
			{201, "O"},
			{202, "P"},
			{203, "Q"},
			{204, "R"},
			{205, "S"},
			{206, "T"},
			{207, "U"},
			{208, "V"},
			{209, "W"},
			{210, "X"},
			{211, "Y"},
			{212, "Z"},
			{213, "a"},
			{214, "b"},
			{215, "c"},
			{216, "d"},
			{217, "e"},
			{218, "f"},
			{219, "g"},
			{220, "h"},
			{221, "i"},
			{222, "j"},
			{223, "k"},
			{224, "l"},
			{225, "m"},
			{226, "n"},
			{227, "o"},
			{228, "p"},
			{229, "q"},
			{230, "r"},
			{231, "s"},
			{232, "t"},
			{233, "u"},
			{234, "v"},
			{235, "w"},
			{236, "x"},
			{237, "y"},
			{238, "z"},
			{239, "▶"},
			{240, ":"},
			{241, "Ä"},
			{242, "Ö"},
			{243, "Ü"},
			{244, "ä"},
			{245, "ö"},
			{246, "ü"},
			{247, "⬆"},
			{248, "⬇"},
			{249, "⬅"}/*,

			{10, "こ"},
			{24, "ね"},
			{31, "ま"},
			{47, "あ"},
			{48, "ぃ"},
			{49, "ぅ"},
			{50, "ぇ"},
			{51, "ぉ"},
			{54, "ょ"},
			{55, "が"},
			{56, "ぎ"},
			{57, "ぐ"},
			{58, "げ"},
			{59, "ご"},
			{60, "ざ"},
			{61, "じ"},
			{62, "ず"},
			{63, "ぜ"},
			{64, "ぞ"},
			{65, "だ"},
			{66, "ぢ"},
			{67, "づ"},
			{68, "で"},
			{69, "ど"},
			{70, "ば"},
			{71, "び"},
			{72, "ぶ"},
			{73, "べ"},
			{74, "ぼ"},
			{75, "ぱ"},
			{76, "ぴ"},
			{77, "ぷ"},
			{78, "ぺ"},
			{79, "ぽ"},
			{80, "っ"},
			{94, "セ"},
			{95, "ソ"},
			{96, "タ"},
			{97, "チ"},
			{98, "ツ"},
			{99, "テ"},
			{100, "ト"},
			{101, "ナ"},
			{102, "ニ"},
			{103, "ヌ"},
			{105, "ノ"},
			{106, "ハ"},
			{107, "ヒ"},
			{108, "フ"},
			{109, "ヘ"},
			{110, "ホ"},
			{112, "ミ"},
			{113, "ム"},
			{114, "メ"},
			{115, "モ"},
			{116, "ヤ"},
			{117, "ユ"},
			{118, "ヨ"},
			{119, "ラ"},
			{120, "リ"},
			{125, "ヲ"},
			{126, "ン"},
			{127, "ァ"},
			{128, "ィ"},
			{129, "ゥ"},
			{130, "ェ"},
			{131, "ォ"},
			{132, "ャ"},
			{133, "ュ"},
			{134, "ョ"},
			{135, "ガ"},
			{136, "ギ"},
			{137, "グ"},
			{138, "ゲ"},
			{139, "ゴ"},
			{140, "ザ"},
			{141, "ジ"},
			{142, "ズ"},
			{143, "ゼ"},
			{144, "ゾ"},
			{145, "ダ"},
			{146, "ヂ"},
			{147, "ヅ"},
			{148, "デ"},
			{149, "ド"},
			{150, "バ"},
			{151, "ビ"},
			{152, "ブ"},
			{153, "ベ"},
			{154, "ボ"},
			{155, "パ"},
			{156, "ピ"},
			{157, "プ"},
			{158, "ペ"},
			{159, "ポ"},
			{160, "ッ"}*/
		};

		#endregion

		#region Japanese Table

		private static Dictionary<byte, string> japaneseTable = new Dictionary<byte, string>() {
			{0, " "},
			{1, "あ"},
			{2, "い"},
			{3, "う"},
			{4, "え"},
			{5, "お"},
			{6, "か"},
			{7, "き"},
			{8, "く"},
			{9, "け"},
			{10, "こ"},
			{11, "さ"},
			{12, "し"},
			{13, "す"},
			{14, "せ"},
			{15, "そ"},
			{16, "た"},
			{17, "ち"},
			{18, "つ"},
			{19, "て"},
			{20, "と"},
			{21, "な"},
			{22, "に"},
			{23, "ぬ"},
			{24, "ね"},
			{25, "の"},
			{26, "は"},
			{27, "ひ"},
			{28, "ふ"},
			{29, "へ"},
			{30, "ほ"},
			{31, "ま"},
			{32, "み"},
			{33, "む"},
			{34, "め"},
			{35, "も"},
			{36, "や"},
			{37, "ゆ"},
			{38, "よ"},
			{39, "ら"},
			{40, "り"},
			{41, "る"},
			{42, "れ"},
			{43, "ろ"},
			{44, "わ"},
			{45, "を"},
			{46, "ん"},
			{47, "ぁ"},
			{48, "ぃ"},
			{49, "ぅ"},
			{50, "ぇ"},
			{51, "ぉ"},
			{52, "ゃ"},
			{53, "ゅ"},
			{54, "ょ"},
			{55, "が"},
			{56, "ぎ"},
			{57, "ぐ"},
			{58, "げ"},
			{59, "ご"},
			{60, "ざ"},
			{61, "じ"},
			{62, "ず"},
			{63, "ぜ"},
			{64, "ぞ"},
			{65, "だ"},
			{66, "ぢ"},
			{67, "づ"},
			{68, "で"},
			{69, "ど"},
			{70, "ば"},
			{71, "び"},
			{72, "ぶ"},
			{73, "べ"},
			{74, "ぼ"},
			{75, "ぱ"},
			{76, "ぴ"},
			{77, "ぷ"},
			{78, "ぺ"},
			{79, "ぽ"},
			{80, "っ"},
			{81, "ア"},
			{82, "イ"},
			{83, "ウ"},
			{84, "エ"},
			{85, "オ"},
			{86, "カ"},
			{87, "キ"},
			{88, "ク"},
			{89, "ケ"},
			{90, "コ"},
			{91, "サ"},
			{92, "シ"},
			{93, "ス"},
			{94, "セ"},
			{95, "ソ"},
			{96, "タ"},
			{97, "チ"},
			{98, "ツ"},
			{99, "テ"},
			{100, "ト"},
			{101, "ナ"},
			{102, "ニ"},
			{103, "ヌ"},
			{104, "ネ"},
			{105, "ノ"},
			{106, "ハ"},
			{107, "ヒ"},
			{108, "フ"},
			{109, "ヘ"},
			{110, "ホ"},
			{111, "マ"},
			{112, "ミ"},
			{113, "ム"},
			{114, "メ"},
			{115, "モ"},
			{116, "ヤ"},
			{117, "ユ"},
			{118, "ヨ"},
			{119, "ラ"},
			{120, "リ"},
			{121, "ル"},
			{122, "レ"},
			{123, "ロ"},
			{124, "ワ"},
			{125, "ヲ"},
			{126, "ン"},
			{127, "ァ"},
			{128, "ィ"},
			{129, "ゥ"},
			{130, "ェ"},
			{131, "ォ"},
			{132, "ャ"},
			{133, "ュ"},
			{134, "ョ"},
			{135, "ガ"},
			{136, "ギ"},
			{137, "グ"},
			{138, "ゲ"},
			{139, "ゴ"},
			{140, "ザ"},
			{141, "ジ"},
			{142, "ズ"},
			{143, "ゼ"},
			{144, "ゾ"},
			{145, "ダ"},
			{146, "ヂ"},
			{147, "ヅ"},
			{148, "デ"},
			{149, "ド"},
			{150, "バ"},
			{151, "ビ"},
			{152, "ブ"},
			{153, "ベ"},
			{154, "ボ"},
			{155, "パ"},
			{156, "ピ"},
			{157, "プ"},
			{158, "ペ"},
			{159, "ポ"},
			{160, "ッ"},
			{161, "0"},
			{162, "1"},
			{163, "2"},
			{164, "3"},
			{165, "4"},
			{166, "5"},
			{167, "6"},
			{168, "7"},
			{169, "8"},
			{170, "9"},
			{171, "！"},
			{172, "？"},
			{173, "。"},
			{174, "ー"},
			{175, "・"},
			{176, " "},
			{177, "『"},
			{178, "』"},
			{179, "「"},
			{180, "」"},
			{181, "♂"},
			{182, "♀"},
			{183, "円"},
			{184, "."},
			{185, "×"},
			{186, "/"},
			{187, "Ａ"},
			{188, "Ｂ"},
			{189, "Ｃ"},
			{190, "Ｄ"},
			{191, "Ｅ"},
			{192, "Ｆ"},
			{193, "Ｇ"},
			{194, "Ｈ"},
			{195, "Ｉ"},
			{196, "Ｊ"},
			{197, "Ｋ"},
			{198, "Ｌ"},
			{199, "Ｍ"},
			{200, "Ｎ"},
			{201, "Ｏ"},
			{202, "Ｐ"},
			{203, "Ｑ"},
			{204, "Ｒ"},
			{205, "Ｓ"},
			{206, "Ｔ"},
			{207, "Ｕ"},
			{208, "Ｖ"},
			{209, "Ｗ"},
			{210, "Ｘ"},
			{211, "Ｙ"},
			{212, "Ｚ"},
			{213, "ａ"},
			{214, "ｂ"},
			{215, "ｃ"},
			{216, "ｄ"},
			{217, "ｅ"},
			{218, "ｆ"},
			{219, "ｇ"},
			{220, "ｈ"},
			{221, "ｉ"},
			{222, "ｊ"},
			{223, "ｋ"},
			{224, "ｌ"},
			{225, "ｍ"},
			{226, "ｎ"},
			{227, "ｏ"},
			{228, "ｐ"},
			{229, "ｑ"},
			{230, "ｒ"},
			{231, "ｓ"},
			{232, "ｔ"},
			{233, "ｕ"},
			{234, "ｖ"},
			{235, "ｗ"},
			{236, "ｘ"},
			{237, "ｙ"},
			{238, "ｚ"},
			{239, "▶"},
			{240, ":"},
			{241, "Ä"},
			{242, "Ö"},
			{243, "Ü"},
			{244, "ä"},
			{245, "ö"},
			{246, "ü"},
			{247, "⬆"},
			{248, "⬇"},
			{249, "⬅"}
		};

		#endregion

		public static string GetCharacter(byte code, Languages language = Languages.English) {
			string s = "";
			if (language == Languages.Japanese)
				japaneseTable.TryGetValue(code, out s);
			else
				englishTable.TryGetValue(code, out s);
			return s;
		}
		public static bool ContainsCharacterCode(byte code, Languages language = Languages.English) {
			if (language == Languages.Japanese)
				return japaneseTable.ContainsKey(code);
			return englishTable.ContainsKey(code);
		}

		public static string GetString(byte[] data, Languages language = Languages.English) {
			string str = "";
			foreach (byte code in data) {
				if (code != byte.MaxValue) {
					string character = "█";
					if (language == Languages.Japanese)
						japaneseTable.TryGetValue(code, out character);
					else
						englishTable.TryGetValue(code, out character);
					str += character;
				}
				else {
					break;
				}
			}
			return str;
		}

		public static string ConvertRomToTextDump(byte[] data) {
			StringBuilder builder = new StringBuilder();
			foreach (byte code in data) {
				if (romTable.ContainsKey(code))
					builder.Append(romTable[code]);

			}
			return builder.ToString();
		}
		public static string ConvertRomToEasyChatTextDump(byte[] data) {
			StringBuilder builder = new StringBuilder();
			int index = 0;
			for (int i = 5865520; i < 5885053; i++) {
				byte code = data[i];
				//if (GetString(ByteHelper.SubByteArray(index, data, 4)) == "UGLY") {
				//	Console.WriteLine(index);
					//5865520
					//
				//}
				if (romTable.ContainsKey(code))
					builder.Append(romTable[code]);
				else
					builder.Append("█");
				index++;
			}
			return builder.ToString();
		}

		public static byte[] GetBytes(string data, int limit, Languages language = Languages.English) {
			data = CharacterEncoding.ConvertToLanguage(data, language);
			byte[] codeArray = new byte[limit];
			string[] arrayFromCharArray = GBACharacterEncoding.CreateStringArrayFromCharArray(data.ToCharArray());
			int index = 0;
			for (int i = 0; i < data.Length; i++) {
				string s = new string(data[i], 1);
				if (index != codeArray.Length) {
					if (language == Languages.Japanese && japaneseTable.Any<KeyValuePair<byte, string>>((KeyValuePair<byte, string> u) => u.Value == s)) {
						KeyValuePair<byte, string> keyValuePair = (from u in japaneseTable where u.Value == s select u).FirstOrDefault<KeyValuePair<byte, string>>();
						codeArray[index] = keyValuePair.Key;
						index++;
					}
					else if (language != Languages.Japanese && englishTable.Any<KeyValuePair<byte, string>>((KeyValuePair<byte, string> u) => u.Value == s)) {
						KeyValuePair<byte, string> keyValuePair = (from u in englishTable where u.Value == s select u).FirstOrDefault<KeyValuePair<byte, string>>();
						codeArray[index] = keyValuePair.Key;
						index++;
					}
					/*else {
						codeArray[index] = 0;
					}
					index++;*/
				}
				else {
					break;
				}
			}
			if (index < limit) {
				for (; index < limit; index++)
					codeArray[index] = byte.MaxValue;
			}
			return codeArray;
		}

		public static string CheckString(string data, Languages language) {
			return GetString(GetBytes(data, 50, language), language);
		}

		public static string[] CreateStringArrayFromCharArray(char[] data) {
			string[] strArray = new string[data.Length];
			int index = 0;
			foreach (char ch in data) {
				strArray[index] = new string(ch, 1);
				index++;
			}
			return strArray;
		}
	}
}
